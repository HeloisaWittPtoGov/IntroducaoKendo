<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>

  <link href="img/icons/pg.favicon.png" rel="shortcut icon">

  <link href="css/pg.kendo.common.min.css" rel="stylesheet">
  <link href="css/pg.kendo.blueopal.min.css" rel="stylesheet">
  <link href="css/pg.kendo.blueopal.mobile.min.css" rel="stylesheet">
  <link href="css/pg.kendo.colors.min.css" rel="stylesheet">
  <link href="css/pg.icons.css" rel="stylesheet">
  <link href="css/pg.libFrontbox.css" rel="stylesheet">
  <link href="css/pg.multiple-select.css" rel="stylesheet">
  <link href="css/pg.loading.css" rel="stylesheet">
  <link href="css/kendo.global.min.css" rel="stylesheet">
  <link href="css/ckeditor.pontogov.css" rel="stylesheet">
  <link rel="stylesheet" href="js/prettyPhoto/css/prettyPhoto.css" type="text/css" media="screen" />
  <link href="js/rs-plugin/css/settings.css" rel="stylesheet">
  <link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.2/themes/redmond/jquery-ui.css">


  <script src="js/libJquery.js" charset="ISO-8859-1"></script>
  <script src="js/jszip.min.js" charset="ISO-8859-1"></script>
  <script src="js/kendo.all.min.js" charset="ISO-8859-1"></script>
  <script src="js/kendo.messages.pt-BR.min.js" charset="ISO-8859-1"></script>
  <script src="js/kendo.masked.date.picker.js" charset="ISO-8859-1"></script>
  <script src="js/kendo.culture.pt-BR.min.js" charset="ISO-8859-1"></script>
  <script src="js/pako_deflate.min.js" charset="ISO-8859-1"></script>
  <script src="js/libPgFilter.js" charset="ISO-8859-1"></script>

  <script src="js/fusion/fusioncharts.js"></script>
  <script src="js/fusion/themes/fusioncharts.theme.fint.js"></script>

  <script src="js/libUtils.js" charset="ISO-8859-1"></script>
  <script src="js/libFrontbox.js" charset="ISO-8859-1"></script>
  <script src="js/kendo.timezones.min.js" charset="ISO-8859-1"></script>
  <script src="js/ckeditor/ckeditor.js"></script>
  <script src="js/jquery-ui.js"></script>
  <script src="js/multiple-select.js"></script>
  <script src="js/prettyPhoto/js/jquery.prettyPhoto.js" type="text/javascript"></script>
  <script src="js/rs-plugin/js/jquery.themepunch.tools.min.js"></script>
  <script src="js/rs-plugin/js/jquery.themepunch.revolution.min.js"></script>
  <script src="js/mascara.js" type="text/javascript"></script>
  <script src="js/jquery.mask.js" charset="ISO-8859-1"></script>

  <style>
    .k-splitbar .k-resize-handle {
      background: none;
      width: 0;
      height: 0;
    }
  </style>

</head>

<script>
  kendo.culture("pt-BR")

  let produtos = [
    { id: "1", nome: "Bolacha Parati", categoria: "Bolacha", preco: 3.00, ativo: "Sim", dataCadastro: "30/05/2025" },
    { id: "2", nome: "Bolacha Panco", categoria: "Café", preco: 2.25, ativo: "Sim", dataCadastro: "30/05/2025" }
  ]

  $(function () {

    $("#BtnPesquisar").kendoButton({
      click: function () {

        let filtros = []

        if ($("#nomeFiltro").val().trim() != "") {
          filtros.push({ field: "nome", operator: "contains", value: $("#nomeFiltro").val() })
        }
        if ($("#categoriaFiltro").val().trim() != "") {
          filtros.push({ field: "categoria", operator: "contains", value: $("#categoriaFiltro").val() })
        }
        $("#GrdConsultaProduto").data("kendoGrid").dataSource.filter(filtros);

        $("#GrdConsultaProduto").data("kendoGrid").dataSource.read();

      }
    })

    $("#BarAcoes").kendoToolBar({
      items: [
        {
          type: "spacer",
        },
        {
          type: "buttonGroup",
          buttons: [
            {
              text: "Incluir",
              id: "BtnIncluir",
              click: function () {
                $("#WinCadastroProduto").data("kendoWindow").open();
                $("#WinCadastroProduto #id").val("");
                $("#WinCadastroProduto #nome").val("");
                $("#WinCadastroProduto #categoria").data("kendoDropDownList").value("");
                $("#WinCadastroProduto #preco").data("kendoNumericTextBox").value("");
                $("#WinCadastroProduto #dataCadastro").val("");
                $("#WinCadastroProduto #FlgAtivo").prop("checked", false)

              }
            },
            {
              text: "Editar",
              id: "BtnEditar",
              enable: false,
              click: function () {
                $("#WinCadastroProduto").data("kendoWindow").open();
                let GrdConsultaProduto = $("#GrdConsultaProduto").data("kendoGrid");
                let rstGrid = GrdConsultaProduto.dataItem(GrdConsultaProduto.select());
                $("#WinCadastroProduto #id").val(rstGrid.id);
                $("#WinCadastroProduto #nome").val(rstGrid.nome);
                $("#WinCadastroProduto #categoria").data("kendoDropDownList").value(rstGrid.categoria);
                $("#WinCadastroProduto #preco").data("kendoNumericTextBox").value(rstGrid.preco);
                $("#WinCadastroProduto #dataCadastro").val(rstGrid.dataCadastro);
                $("#WinCadastroProduto #FlgAtivo").prop("checked", rstGrid.ativo == "Sim");
              }
            },
          ]
        }
      ]
    });

    $("#GrdConsultaProduto").kendoGrid({
      toolbar: ["excel"],

      columns: [
        {
          field: "id",
          title: "ID",
          width: "80px"
        },
        {
          field: "nome",
          title: "Nome",
        },
        {
          field: "categoria",
          title: "Categoria",
        },
        {
          field: "preco",
          title: "Preço",
          width: "100px",
          format: "{0:c}",
        },
        {
          field: "dataCadastro",
          title: "Data de Cadastro",
          width: "150px",
        },
        {
          field: "ativo",
          title: "Ativo",
          width: "100px"
        }
      ],
      dataSource: {
        transport: {
          read: function (options) {
            console.log(produtos)
            options.success(produtos)
          }
        }
      },
      selectable: "row",
      change: function () {
        let GrdConsultaProduto = $("#GrdConsultaProduto").data("kendoGrid");
        let item = GrdConsultaProduto.dataItem(GrdConsultaProduto.select())
        $("#tabStripConsultaProduto #id").val(item.id);
        $("#tabStripConsultaProduto #nome").val(item.nome);
        $("#tabStripConsultaProduto #categoria").val(item.categoria);
        $("#tabStripConsultaProduto #preco").val(item.preco);
        $("#tabStripConsultaProduto #dataCadastro").val(item.dataCadastro);
        $("#BarAcoes").data("kendoToolBar").enable("#BtnEditar");
      },

    });

    $("#WinCadastroProduto").kendoWindow({
      width: 800,
      visible: false,
      title: "Cadastro de Produtos",
      maxWidth: 800,
      maxHeight: 200,
      position: {
        top: 140,
        left: "20%"
      }
    });

    $("#BarAcoesWin").kendoToolBar({
      items: [
        {
          type: "spacer",
        },
        {
          type: "buttonGroup",
          buttons: [
            {
              text: "Gravar",
              id: "BtnGravar",
              click: function () {

                let idCadastro = $("#id").val()
                let indiceId = produtos.findIndex(i => i.id == idCadastro);

                let strMensagem = "";

                if ($("#WinCadastroProduto #nome").val().trim() == "") {
                  strMensagem = strMensagem + "O campo nome é de preechimento obrigatório.\n"
                } else {
                  let nomeInformado = $("#WinCadastroProduto #nome").val().trim().toLowerCase();
                  let verificaNome = produtos.find(function (i) {
                    return i.nome.trim().toLocaleLowerCase() == nomeInformado && i.id != idCadastro
                  })
                  if (verificaNome) {
                    strMensagem = strMensagem + "Já existe um produto cadastrado com o nome informado.\n"
                  }
                }

                if ($("#WinCadastroProduto #categoria").val().trim() == "") {
                  strMensagem = strMensagem + "O campo Categoria é de preenchimento obrigatório.\n"
                }

                if ($("#WinCadastroProduto #preco").val().trim() <= 0) {
                  strMensagem = strMensagem + "O Preço deve ser maior que 0,00."
                }

                if (strMensagem != "") {
                  alert(strMensagem)
                }

                if (indiceId >= 0) {
                  produtos[indiceId] = {
                    id: idCadastro,
                    nome: $("#WinCadastroProduto #nome").val(),
                    categoria: $("#WinCadastroProduto #categoria").data("kendoDropDownList").value(),
                    preco: $("#WinCadastroProduto #preco").data("kendoNumericTextBox").value(),
                    dataCadastro: $("#WinCadastroProduto #dataCadastro").val(),
                    ativo: $("#WinCadastroProduto #FlgAtivo").is(":checked") ? "Sim" : "Não"

                  }
                }
                else {
                  produtos.push({
                    id: $("#GrdConsultaProduto").data("kendoGrid").dataSource.data().length + 1,
                    nome: $("#WinCadastroProduto #nome").val(),
                    categoria: $("#WinCadastroProduto #categoria").data("kendoDropDownList").value(),
                    preco: $("#WinCadastroProduto #preco").data("kendoNumericTextBox").value(),
                    dataCadastro: $("#WinCadastroProduto #dataCadastro").val(),
                    ativo: $("#WinCadastroProduto #FlgAtivo").is(":checked") ? "Sim" : "Não"
                  })
                }

                $("#BtnPesquisar").click();
              }
            },
            {
              text: "Excluir",
              id: "BtnExcluir",
              click: function () {
                let GrdConsultaProduto = $("#GrdConsultaProduto").data("kendoGrid");
                let item = GrdConsultaProduto.dataItem(GrdConsultaProduto.select());
                let indiceRemover = produtos.findIndex(i => i.id === item.id)
                produtos.splice(indiceRemover, 1)

                $("#BtnPesquisar").click()
              }
            },
            {
              text: "Limpar",
              id: "BtnLimpar",
              click: function () {
                $("#WinCadastroProduto").data("kendoWindow").open();
                $("#WinCadastroProduto #id").val("");
                $("#WinCadastroProduto #nome").val("");
                $("#WinCadastroProduto #categoria").data("kendoDropDownList").value("");
                $("#WinCadastroProduto #preco").data("kendoNumericTextBox").value("");
                $("#WinCadastroProduto #dataCadastro").val("");
                $("#WinCadastroProduto #FlgAtivo").prop("checked", false)
              }
            },
            {
              text: "Fechar",
              id: "BtnFechar",
              click: function () {
                $("#WinCadastroProduto").data("kendoWindow").close()
              }
            }
          ]
        }
      ]
    })
    $("#WinCadastroProduto #categoria").kendoDropDownList({
      dataSource: [
        { name: "" },
        { name: "Bolacha" },
        { name: "Café" },
        { name: "Trigo" }
      ],
      dataTextField: "name",
      dataValueField: "name",
    });

    $("#WinCadastroProduto #preco").kendoNumericTextBox({
      decimals: 2,
      format: "c2",
    })

    $("#WinCadastroProduto #dataCadastro").kendoDatePicker({
      dateInput: true,
      format: "dd/MM/yyyy"
    })

    $("#tabStripConsultaProduto").kendoTabStrip()

    $("#splConsulta").kendoSplitter({
      orientation: "vertical",
      panes: [{ min: "25px" }, { min: "100px" }, {}],
    })


  });

</script>

<body>
  <div id="splConsulta" style="height: 100%;">
    <div id="splHeader">
      <div class="k-filter k-bg-blue screen-filter-content">
        <input class="k-textbox" type="text" id="nomeFiltro" placeholder="Informe o nome">
        <input class="k-textbox" type="text" id="categoriaFiltro" placeholder="Informe a categoria">
        <span id="BtnPesquisar">Pesquisar</span>
      </div>
      <div id="BarAcoes"></div>
    </div>

    <div id="splMiddle">
      <div id="GrdConsultaProduto"></div>
    </div>

    <div id="splFooter">
      <div id="tabStripConsultaProduto">
        <ul>
          <li class="k-state-active">Detalhes</li>
        </ul>
        <div id="infosDetalhes">
          <table>
            <td style="text-align: right; width: 118px;">
              ID:
            </td>
            <td>
              <input id="id" type="text" class="k-textbox k-input-disabled" style="width: 80px;">
            </td>
          </table>
          <table width="100%" cellpadding="0" cellspancing="2" role="presentation">
            <tr>
              <td style="text-align: right; width: 120px;">
                Nome:
              </td>
              <td>
                <input type="text" id="nome" class="k-textbox k-input-disabled" style="width: 600px;">
              </td>
            </tr>
          </table>
          <table width="100%" cellpadding="0" cellspancing="2" role="presentation">
            <tr>
              <td style="text-align: right; width: 120px;">
                Categoria:
              </td>
              <td>
                <input id="categoria" style="width: 600px;" class="k-textbox k-input-disabled">
              </td>
            </tr>
          </table>
          <table width="100%" cellpadding="0" cellspancing="2" role="presentation">
            <tr>
              <td style="text-align: right; width: 120px;">
                Preço:
              </td>
              <td style="width: 315px;">
                <input id="preco" class="k-input-disabled k-textbox">
              </td>
              <td style="text-align: right; width: 150px;">
                Data de Cadastro:
              </td>
              <td>
                <input id="dataCadastro" class="k-input-disabled k-textbox">
              </td>
            </tr>
          </table>
        </div>
      </div>
    </div>
  </div>

  <div id="WinCadastroProduto" style="display: flex; justify-content: center;align-items: center;">
    <div id="form" class="k-form" style="width: 100%;">
      <form>
        <table width="100%" cellpadding="0" cellspancing="2" role="presentation">
          <tr>
            <td style="text-align: right; width: 120px;">
              ID:
            </td>
            <td>
              <input id="id" type="text" class="k-textbox k-input-disabled" style="width: 80px;">
            </td>
          </tr>
        </table>
        <table width="100%" cellpadding="0" cellspancing="2" role="presentation">
          <tr>
            <td style="text-align: right; width: 120px;" class="k-required">
              Nome:
            </td>
            <td>
              <input type="text" id="nome" class="k-textbox" style="width: 600px;">
            </td>
          </tr>
        </table>
        <table width="100%" cellpadding="0" cellspancing="2" role="presentation">
          <tr>
            <td style="text-align: right; width: 120px;" class="k-required">
              Categoria:
            </td>
            <td>
              <input id="categoria" style="width: 600px;">
            </td>
          </tr>
        </table>
        <table width="100%" cellpadding="0" cellspancing="2" role="presentation">
          <tr>
            <td style="text-align: right; width: 120px;" class="k-required">
              Preço:
            </td>
            <td>
              <input id="preco">
            </td>
            <td style="text-align: right; width: 273px;">
              Data de Cadastro:
            </td>
            <td>
              <input id="dataCadastro">
            </td>
          </tr>
        </table>
        <table width="100%" cellpadding="0" cellspancing="2" role="presentation">
          <tr>
            <td>
              <input id="FlgAtivo" type="checkbox" style="margin-left: 120px;" class="k-checkbox">
              <label for="FlgAtivo" class="k-checkbox-label">Ativo</label>
            </td>
          </tr>
        </table>
        <div id="BarAcoesWin"></div>
      </form>
    </div>
  </div>
</body>

</html>